<html>
<head>
    <script src="css/source-sans-pro.js"></script>
    <link href="css/jquery.datepick.css" rel="stylesheet">

    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/jquery.mobile-1.3.1.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta charset="utf-8">
</head>
<body>
    <div data-theme="a" data-role="page" id="home">
    <div data-theme="a" data-role="header" data-position="fixed">
        <h1>
            My Supply
        </h1>
    </div>
    <div data-role="content">
        <ul data-role="listview" data-divider-theme="b" data-inset="true">
            <li data-theme="c">
                <a href="availability.html" data-transition="none">
                    My Availability
                </a>
            </li>
            <li data-theme="c">
                <a href="timesheets.html" data-transition="none">
                    My Timesheets
                </a>
            </li>
            <li data-theme="c">
                <a href="create-timesheet.html" data-transition="slide">
                    Create Timesheet
                </a>
            </li>
            <li data-theme="c">
                <a href="#home" data-transition="slide">
                    Settings
                </a>
            </li>
        </ul>
    </div>
</div>
<script type="text/javascript">// <![CDATA[
if (navigator.userAgent.toLowerCase().match(/android/)) {
    document.write('<script charset="utf-8" src="cordova-2.7.0-android.js"><\/script>');
}
else if (navigator.userAgent.toLowerCase().match(/iphone/) || navigator.userAgent.toLowerCase().match(/ipad/)) {
    document.write('<script charset="utf-8" src="cordova/cordova-2.7.0-ios.js"><\/script>');
}
// ]]>
</script>
<script src="lib/jquery-1.8.2.min.js"></script>
<script>
$(document).bind("mobileinit", function(){
  $.mobile.defaultPageTransition = 'none';
});
</script>
<script src="lib/jquery.mobile-1.3.1.min.js"></script>
<script src="lib/jquery.datepick.js"></script>
<script src="lib/bootstrap.min.js"></script>
<script src="lib/countdown.min.js"></script>
<script src="lib/moment.min.js"></script>
<script src="js/LoginView.js"></script>
<script src="js/AvailabilityView.js"></script>

<script type="text/javascript">
/**
 * @author: Chris Hjorth, www.chrishjorth.com
 */
 var jqmReady = $.Deferred();
 var pgReady = $.Deferred();
 var browser = false;
 var tsForm = { selectedLa: null }
 var app = {
   //Callback for when the app is ready
   callback: null,
   // Application Constructor
   initialize: function(callback) {
      this.callback = callback;
      browser = document.URL.match(/^https?:/);
      if(browser) {
       console.log("Is web.");
         //In case of web we ignore PG but resolve the Deferred Object to trigger initialization
         pgReady.resolve();
     }
     else {
       console.log("Is not web.");
       this.bindEvents();
   }
},
bindEvents: function() {
  document.addEventListener('deviceready', this.onDeviceReady, false);
},
onDeviceReady: function() {
      // The scope of 'this' is the event, hence we need to use app.
      app.receivedEvent('deviceready');
  },
  receivedEvent: function(event) {
      switch(event) {
       case 'deviceready':
       pgReady.resolve();
       break;
   }
}
};
$(document).on("pageinit", function(event, ui) {
 jqmReady.resolve();
});
/**
 * General initialization.
 */
 $.when(jqmReady, pgReady).then(function() {
   //Initialization code here
   if(app.callback) {
      app.callback();
  }
  console.log("Frameworks ready.");   

});
 $( document ).delegate("#home", "pageinit", function() {    
    if(!new LoginHelper().isLoggedIn()){
        console.log("Redirecting to login page");  
        /*if(browser){
            $('#hidden-home-link').show();    
        }
        else{*/
            $.mobile.changePage("login.html", { reverse: false, changeHash: false,transition: "fade"});
        //}        
    } 
    else{
        console.log("Showing login");
        $('#login-container').show();
    }   
});
 $( document ).delegate("#login-page", "pageinit", function() {
    var login = new LoginView();
    login.postRender();
});
 $( document ).delegate("#availability-page", "pageinit", function() {
    var availability = new AvailabilityView();
    availability.postRender();
});
 $(document).delegate( "#select-la-widget","pageinit",  function( e ) {
    $('#la-list a').on('click', function(e) {
        e.preventDefault();
        var selectedLa = this.text;
        tsForm.selectedLa = this.text
        $.mobile.changePage('create-timesheet.html', {
          reverse: false, changeHash: false,transition: "none",
            data: {
                la: selectedLa
            }
        });
    });
});
 $(document).delegate( "#create-timesheet-page","pageinit",  function( e ) {
  $(document).delegate( "#la-select","focus",  function( e ) {  
      $.mobile.changePage("select-la.html", { reverse: false, changeHash: false,transition: "none"});
  });
});
 app.initialize(function() {

 });
 </script>

</body>
</html>